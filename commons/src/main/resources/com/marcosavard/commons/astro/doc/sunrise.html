<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head><meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"><title>sunrise</title></head><body>
  <img src="http://www.stargazing.net/kepler/banner.gif" alt="Approximate astronomical positions" style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;" border="0" height="30" width="400"><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;"></span>
<h1 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig00">Sun rise and set, and twilight</a></h1>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/index.html#top" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Root</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<hr style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<h2 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Contents</h2>
<ul style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<li><a href="http://www.stargazing.net/kepler/sunrise.html#twig01">Overview and method</a></li><li><a href="http://www.stargazing.net/kepler/sunrise.html#twig02">Formulas and example calculation</a><ul><li><a href="http://www.stargazing.net/kepler/sunrise.html#twig02a">Centuries since J2000.0</a></li><li><a href="http://www.stargazing.net/kepler/sunrise.html#twig02b">Sun's position</a></li><li><a href="http://www.stargazing.net/kepler/sunrise.html#twig02c">Correction term and new estimate of time of sunrise</a></li><li><a href="http://www.stargazing.net/kepler/sunrise.html#twig02e">Recalculation for second approximation</a></li></ul></li><li><a href="http://www.stargazing.net/kepler/sunrise.html#twig03">Spreadsheet</a><ul><li><a href="http://www.stargazing.net/kepler/sunrise.html#twig03a">Input area</a></li><li><a href="http://www.stargazing.net/kepler/sunrise.html#twig03b">Output area part one</a></li><li><a href="http://www.stargazing.net/kepler/sunrise.html#twig03c">Calculation area, first approximation</a></li><li><a href="http://www.stargazing.net/kepler/sunrise.html#twig03d">Calculation area, further approximations</a></li><li><a href="http://www.stargazing.net/kepler/sunrise.html#twig03e">Output area part 2</a></li></ul></li><li><a href="http://www.stargazing.net/kepler/sunrise.html#twig04">Excel VBA 'user defined' functions</a></li><li><a href="http://www.stargazing.net/kepler/sunrise.html#twig04a">QBASIC program</a></li><li><a href="http://www.stargazing.net/kepler/sunrise.html#twig05">References</a></li>
</ul>
<h2 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig01">Overview and method</a></h2>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/sunrise.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">This
page contains a recipe for finding the times of events such as sunrise,
sunset, and the times for various definitions of twilight. The recipe
is illustrated by direct calculation, and implemented as</p>
<ul style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<li>a 'portable' spreadsheet using only 'standard' functions</li><li>as an Excel enhanced spreadsheet using VBA functions</li><li>as a<span>&nbsp;</span><code>QBASIC</code><span>&nbsp;</span>program</li>
</ul>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Sunrise
and sunset are often defined as the instant when the upper limb of the
Sun's disk is just touching the observer's mathematical horizon
assuming a spherical earth, and allowing for the atmospheric
refraction. This corresponds to an altitude of -0.833 degrees for the
Sun. The various 'twilights' are usually defined in terms of the Sun's
altitude as follows;</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">       Astronomical twilight      altitude -18 degrees<br>       Nautical twilight          altitude -12 degrees<br>       Civil twilight             altitude  -6 degrees<br></pre>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">The
limit of astronomical twilight is defined as when the light from the
Sun scattered by the atmosphere is roughly the same as that the
combined light from the stars, the zodiacal light and the<span>&nbsp;</span></span><em style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">gegenschein</em><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">.
In my inner city area, the sky brightness never drops to such a low
level, so I use the nautical twilight to indicate observing times.</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The method implemented on this page is taken from the<span>&nbsp;</span><cite>Explanatory Supplement to the Astronomical Almanac</cite><span>&nbsp;</span>section
9.33, and uses a simple iterative scheme which will converge on the
times of events. This method may not converge above latitudes of 60
degrees North, or below latitudes of 60 degrees South. The times
produced are found to be within seconds of times from a planatarium
program, and Dr Ahmed Monsur's Mooncalc. A similar method is explained
by<span>&nbsp;</span><a href="http://193.12.249.96/pausch/comp/ppcomp.html">Paul Schlyter</a><span>&nbsp;</span>on his excellent page.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The
method described on this page falls into a number of steps. Suppose we
want to calculate the time of Sunrise one autumn morning. The process
goes as follows;</p>
<ol style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<li>find the number of days from 0h UT on the day in question to
J2000.0, and divide this by 36525 to find the number of julian
centuries, t</li><li>Guess a figure for the UT at which the sunrise occurs</li><li>Calculate the Hour angle and declination at the Greenwich meridian for the Sun at the time of the current guess,</li><li>Calculate
a correction term and use the term to arrive at a new guess for the
time of the sunrise, ensuring that the times stay within the range 0 to
24 hours,</li><li>Repeat steps 3 and 4 until there is no significant difference between the succesive estimates of times for the sunrise</li><li>This time is the time of the sunrise.</li>
</ol>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">You
can calculate the rise and set times of the Sun for any day in the past
or future 500 years to reasonable accuracy using an ordinary pocket
calculator. However, there is a large calculational effort at each
repetition of steps 3 and 4, and most people will use a programmable
calculator, a spreadsheet or a program function to calculate the times
of events.</p>
<h2 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig02">Formulas and example calculation</a></h2>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/sunrise.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">As
a concrete example, I shall calculate the time of the Sunrise on 1998
October 25th at Birmingham UK, latitude 52.5N, longitude 1.9167W.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">We
start by finding the number of centuries since J2000.0, as all the
formulas for the position of the Sun depend on this. As outlined above,
we calculate the position of the Sun for 0h on the day in question. We
use this position to calculate the time of Sunrise (even though the Sun
will have moved a fraction of a degree in the sky), and then
recalculate the position of the Sun for the new time. A refined time
for the Sunrise can then be calculated.</p>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig02a">Centuries since J2000.0</a></h3>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/sunrise.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">We
find the number of days since J2000.0 (in this case a negative number)
and then divide by 36525 to find the number of (julian) centuries. The
table below can be used to find the days since J2000.0;</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">Calculating the centuries from J2000<br>------------------------------------<br><br>The tables below can be used to calculate the number of days and<br>the fraction of a day since the epoch J2000. If you need the<br>number of Julian centuaries, then just divide the 'day number' <br>by 36525.<br><br>Table A                |  Table B<br>Days to beginning of   |  Days since J2000 to<br>month                  |  beginning of each year<br>                       |<br>Month   Normal   Leap  |  Year   Days    |  Year   Days<br>        year     year  |                 |<br>                       |                 |<br>Jan       0        0   |  1998   -731.5  |   2010  3651.5<br>Feb      31       31   |  1999   -366.5  |   2011  4016.5<br>Mar      59       60   |  2000     -1.5  |   2012  4381.5<br>Apr      90       91   |  2001    364.5  |   2013  4747.5<br>May     120      121   |  2002    729.5  |   2014  5112.5    <br>Jun     151      152   |  2003   1094.5  |   2015  5477.5<br>Jul     181      182   |  2004   1459.5  |   2016  5842.5<br>Aug     212      213   |  2005   1825.5  |   2017  6208.5<br>Sep     243      244   |  2006   2190.5  |   2018  6573.5<br>Oct     273      274   |  2007   2555.5  |   2019  6938.5<br>Nov     304      305   |  2008   2920.5  |   2020  7303.5<br>Dec     334      335   |  2009   3286.5  |   2021  7669.5<br><br>Worked Example<br>                                                               <br>To find the number of days from J2000.0 for 1998 October 25th,<br>   <br>1. find from table A the number of days to the beginning of<br>October from the start of the year, here 273 days<br>   <br>4. write down the day number within the month, here 25 above<br><br>5. find from table B the days since J2000.0 to the beginning of<br>the year, here -731.5<br>   <br>6. add these three numbers.<br><br>For the date above;<br><br>   273 + 25 + -731.5 = -433.5 days from J2000.0<br><br>7. to find the number of centuries t, divide by 36525,<br><br>   t = -433.5 / 36525 = -0.01186858316<br></pre>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig02b">Sun's position</a></h3>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/sunrise.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">In
all the calculations below, we measure time in degrees (180 degs =
12h), and we take a crude first guess at the time of sunrise as 12h UT
on the day (180).</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The
'low precision' formulas below give the Sun's position to an accuracy
of about 0.1 degree over a few centuries either side of J2000.0. Taking
the figure of t = -0.01186858316 for the number of Julian centuries
since J2000.0 as calculated above for our example date;</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">L = 280.460 + 36000.770 * t   (Mean longitude including aberration)<br>  = -146.81813257 + 360<br>  = 213.1818674<br>  <br>G = 357.528 + 35999.050 * t   (Mean anomaly)<br>  = -69.7297186 + 360<br>  = 290.2702814<br>  <br>ec = 1.915 * sin(G) + 0.020 * sin(2*G) (eq centre correction)<br>   = -1.7964017 - 0.0129997<br>   = -1.8094014<br><br>lambda = L + ec    (ecliptic longitude of Sun)<br>       = 213.1818674 - 1.8094014<br>       = 211.3724660<br><br>E = -ec + 2.466 * sin (2 * lambda) - 0.053 * sin(4 * lambda)<br>  = 1.8094014 + 2.1922164 - 0.0431536<br>  = 3.9584642<br>  <br>GHA = UTo - 180 + E, <br><br>where UTo is the current estimate of the time of Sunrise expressed in<br>degrees. For this first iteration, this gives<br><br>GHA = 180 - 180 + E    (Hour angle of Sun on Greenwich meridian)<br>    = 3.9584642<br><br>We also need the Sun's declination (delta), for which we need the<br>obliquity of the ecliptic (tilt of the Earth's axis);<br><br>Obl = 23.4393 - 0.0130 * t<br>    = 23.43945429<br>    <br>delta = asin ( sin (obl) * sin(lambda))   (Sun's declination)<br>      = -11.9515161<br></pre>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig02c">Correction term and new estimate of time</a></h3>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/sunrise.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The guts of this iterative algorithm are the two formulas below;</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">                UT' = UT - (GHA + long + correction)        [1]<br>       <br>       <br>                          sin(h) - sin(phi) * sin(delta)<br>              cosc   =   --------------------------------  [2]<br>                              cos(phi) * cos(delta)<br>                              <br>       If cosc &gt; 1 then correction = 0<br>          Else<br>       If cosc &lt; -1 then correction = 180<br>          Else<br>       Correction = acos(cosc)<br>       <br></pre>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">Formula
[1] gives us a way of calculating a better estimate of the time of
sunrise, given the current estimate (ut) and the hour angle of the Sun
for that time, and the correction term. The quantity GHA + long gives
us the Sun's hour angle on the local meridian. Our first guess for the
time of sunrise is ut = 180.</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">For setting events (sunset, end of twilight) we subtract the correction term in formula [1];</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">     (setting)     UT' = UT - (GHA + long - correction)        [1]    <br></pre>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">Formula
[2] gives us the value of the correction term for each successive
estimate. As we will see in the spreadsheet example below, the
correction terms converge rapidly to a single value under most
circumstances. You have to calculate the correction term first, before
you can use the iteration formula [1] to find your next estimate. I've
never really understood why the textbooks list them in this order!</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">For our example date of 1998 October 25th, at Birmingham (phi = 52.5, long = -1.9167), we have for the correction term [2];</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">       <br>                          sin(h) - sin(phi) * sin(delta)<br>              cosc   =   --------------------------------  <br>                              cos(phi) * cos(delta)<br>                              <br>                              <br>                     =    -0.1453808 - 0.79335234 * -0.20708391<br>                         ---------------------------------------<br>                              0.608761429 * 0.978323186<br>                              <br>                     =    0.14975242<br>                         ------------  =  0.2514458<br>                          0.59556542<br>                          <br>          acos(cosc) = correction = 75.436916                        <br></pre>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">and this leads to the refined estimate for the time of Sunrise;</span>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">                UT' = UT - (GHA + long + correction)        [1]<br>           <br>                UT' = 180 - (3.9584642 + -1.9167 + 75.436916)<br>           <br>                    = 102.52132 degrees<br>                    = 6.83475 hrs UT.<br></pre>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig02e">Recalculation for second approximation</a></h3>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/sunrise.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The above is not a bad approximation to the true time that day, but we can calculate the next approximation by;</p>
<ul style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<li>re-calculating the number of centuries since J2000.0 using the new estimate of UT</li><li>recalculating the position of the Sun for the new t value,</li><li>calculating a new correction term [2]</li><li>using the iteration formula [1] to calculate the new time</li>
</ul>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">Below is a summary of this second iteration, the formulas for the Sun's position are identical to those above.</span>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">New figure for centuries;<br><br>t = (-433.5 + 102.52132/360) /36525<br>  = -0.0118607863<br><br>Sun's modified position<br><br>     L = 213.4625604<br>     G = 290.5509609<br>    ec = - 1.7931300 - 0.0131480 = -1.806278<br>lambda = 211.6562823<br><br>     E = 1.806278 + 2.2032968 - 0.0425355<br>       = 3.9670393<br>       <br>   GHA = ut' - 180 + E<br>       = 102.52132 - 180 + 3.9670393<br>       = - 73.5116407<br><br>New obliquity and declination<br><br>   Obl = 23.43945419      (not very significant change!)<br> delta = -12.04991163<br> <br>Correction term<br><br>             cosc =      -0.1453808 - 0.79335234 * -0.208763698<br>                         ---------------------------------------<br>                              0.608761429 * 0.977966113<br>                              <br>             (notice that only the values of cos and sin of delta         <br>              actually change, the other numbers stay the same)<br>              <br>        correction = acos(cosc) = 75.298919<br>              <br>New estimate of UT<br><br>            ut'' = ut' - (GHA + long + correction)<br>            ut'' = 102.52132 - (-73.5116407 - 1.9167 + 75.298919)<br>                 = 102.650741<br>                 = 6.84338 hrs UT<br>                 = 6 h 50 m 36 sec<br></pre>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">When
I did this calculation myself (using a basic scientific calculator and
rounding answers in a convenient if unsystematic way) I used a column
layout, with a new column for the second iteration.</p>
<h2 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig03">Spreadsheet</a></h2>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/sunrise.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">As
a 'column based' layout seems so natural for this kind of calculation,
I have devised a simple spreadsheet based on the formulas above. I have
tried to use 'standard' formulas and so if you follow the instructions
below, you should be able to build a working spreadsheet using just
about any spreadsheet program you may have.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The<span>&nbsp;</span><tt><a href="http://www.stargazing.net/kepler/sunrise.zip">sunrise.zip</a></tt><span>&nbsp;</span>file contains copies of this spreadsheet in<span>&nbsp;</span><tt>.WKS</tt><span>&nbsp;</span>and<span>&nbsp;</span><tt>.SLK</tt><span>&nbsp;</span>formats, as well as the full MS Excel version. One of these should load into most spreadsheet programs.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The main limitations of working in a 'portable' spreadsheet format are;</p>
<ul style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<li>all the trig functions work in radians! I have converted the coefficients in the formulas to give angles in radian measure</li><li>I can't make assumptions about being able to 'name' certain cells, so I have to use 'absolute cell referencing'</li><li>the<span>&nbsp;</span><tt>=mod(x,y)</tt><span>&nbsp;</span>function changes implementation from program to program, but this does not change the final answers.</li>
</ul>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">To
build the spreadsheet, I have an 'input area' with labels in A5 to A12
and corresponding values in B5 to B12, and an 'output area' with labels
in D5:D8 and the results of the calculations in E5:E8. The main
calculation consists of four successive approximations to the UT of the
event, and I put these calculations in the cells B17 to E28, with
labels for each term in A17 to A28. It might help if you look at a<span>&nbsp;</span><a href="http://www.stargazing.net/kepler/sunsheet.gif">screenshot of the basic spreadsheet layout</a>.</p>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig03a">Input area</a></h3>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/sunrise.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Put the following labels in A5 to A12;</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">Year<br>Month<br>Day<br>Latitude<br>Longitude<br>time zone<br>Required alt<br>Rise or set<br></pre>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">and put the 'test values' in B5 to B12;</span>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">1998<br>10<br>25<br>52.5<br>-1.9167<br>0<br>-0.833 (-6, -12 or -18 for twilights)<br>1      (-1 for setting events instead of rising events)<br></pre>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">These
values correspond to 1998 October 25th, Birmingham, no zone offset,
finding Sunrise (upper limb in contact with mathematical horizon), and
a rise event.</span>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig03b">Output area part one</a></h3>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">[<a href="http://www.stargazing.net/kepler/sunrise.html#twig00">Top</a>]</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Put the following labels into cells D5 to D8;</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">Event UT<br>Event zone time<br>Days since J2000<br>Centuries <br></pre>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">and put the following formulas into E7 and E8,</span>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">=367*B5-INT(7*(B5+INT((B6+9)/12))/4)+INT(275*B6/9)+B7-730531.5<br>=E7/36525<br></pre>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">These formulas will give the number of days from J2000.0 in cell<span>&nbsp;</span></span><tt style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">E7</tt><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">and the number of Julian centuries from J2000.0 in<span>&nbsp;</span></span><tt style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">E8</tt><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">. I get -433.5 and -0.0118685832 in cells E7 and E8 using the 1998 October 25th test date.</span>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig03c">Calculation area, first approximation</a></h3>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">[<a href="http://www.stargazing.net/kepler/sunrise.html#twig00">Top</a>]</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Now put the following labels into cells A17 to A28, these names should tie in with the example calculations above;</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">L<br>G<br>ec<br>lambda<br>E<br>obl<br>delta<br>GHA<br>cosc<br>correction<br>utnew<br>new centuries<br></pre>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Now we can put the first column of formulas into cells<span>&nbsp;</span><tt>B17 to B28</tt>. You should be able to copy and paste the formulas into a spreadsheet as one block;</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">=MOD(4.8949504201433+628.331969753199*$E$8,6.28318530718)<br>=MOD(6.2400408+628.3019501*$E$8,6.28318530718)<br>=0.033423*SIN(B18)+0.00034907*SIN(2*B18)<br>=B17+B19<br>=0.0430398*SIN(2*B20) - 0.00092502*SIN(4*B20) - B19<br>=0.409093-0.0002269*$E$8<br>=ASIN(SIN(B22)*SIN(B20))<br>=3.14159265358979 - 3.14159265358979 + B21<br>=(SIN(0.017453293*$B$11) - SIN(0.017453293*$B$8)*SIN(B23))/(COS(0.017453293*$B$8)*COS(B23))<br>=ACOS(B25)<br>=3.14159265358979 - (B24+0.017453293*$B$9 + $B$12*B26)<br>=($E$7 + B27/(6.28318530718))/36525<br></pre>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">Notice
the use of 'absolute cell referencing' for $E$7, $E$8, and a few other
cells. Note how I have kept a large number of decimal places in the
coeficients for the mean longitude (L) calculation. Any rounding here
causes trouble. Using our example data for Sunrise on 1998 October
25th, at Birmingham, 52.5 N, 1.9167 W, I get the following values in
cells B17 to B28 (output formatted to 6 decimal places);</span>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">3.720725<br>5.066172<br>-0.031580<br>3.689146<br>0.069088<br>0.409096<br>-0.208593<br>0.069088<br>0.251446<br>1.316622<br>1.789335<br>-0.011861<br></pre>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig03d">Calculation area, further approximations</a></h3>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">[<a href="http://www.stargazing.net/kepler/sunrise.html#twig00">Top</a>]</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The
next set of formulas in cells C17 to C28 calculates the next
approximation to the time of Sunrise, these formulas are slightly
different to the first column in that they pick up the new centuries
figure from B28 and the new guess for UT from cell B27;</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">=MOD(4.8949504201433+628.331969753199*B28,6.28318530718)<br>=MOD(6.2400408+628.3019501*B28,6.28318530718)<br>=0.033423*SIN(C18)+0.00034907*SIN(2*C18)<br>=C17+C19<br>=0.0430398*SIN(2*C20) - 0.00092502*SIN(4*C20) - C19<br>=0.409093-0.0002269*B28<br>=ASIN(SIN(C22)*SIN(C20))<br>=B27 - 3.14159265358979 + C21<br>=(SIN(0.017453293*$B$11) - SIN(0.017453293*$B$8)*SIN(C23))/(COS(0.017453293*$B$8)*COS(C23))<br>=ACOS(C25)<br>=B27 - (C24+0.017453293*$B$9 + $B$12*C26)<br>=($E$7 + C27/6.28318530718)/36525<br></pre>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">And using the test values, I got the following values in cells C17 to C28;</span>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">3.725625<br>5.071071<br>-0.031525<br>3.694099<br>0.069238<br>0.409096<br>-0.210311<br>-1.283020<br>0.253776<br>1.314214<br>1.791594<br>-0.011861<br></pre>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">You
can now copy the formulas from C17:C28 into D17:D28 and into E17:E28 to
provide the next iterations in the calculation. I get the following
values in D17:D28, and E17:E28 when doing this;</span>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">3.725631    3.725631<br>5.071077    5.071077<br>-0.031525   -0.031525<br>3.694105    3.694105<br>0.069238    0.069238<br>0.409096    0.409096<br>-0.210313   -0.210313<br>-1.280761   -1.280758<br>0.253779    0.253779<br>1.314211    1.314211<br>1.791597    1.791597<br>-0.011861   -0.011861<br></pre>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">Four
iterations are usually enough to get a reliable result, and as you can
see the results in C27 and D27 (1.791597) are identical to 6 dp in this
case.</span>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig03e">Output area part 2</a></h3>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">[<a href="http://www.stargazing.net/kepler/sunrise.html#twig00">Top</a>]</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">I put the time of Sunrise in cell E5 with the following formula to convert the time from radians to hours;</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">=E27*57.29577951/15<br>=E5 + B10<br></pre>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">Cell
E8 now holds the time of the event in decimal hours in the time zone
entered in cell B10 originally. For Birmingham on 1998 October 25th, I
get 6.843 UT as the decimal hours of Sunrise, which corresponds to 0651
hrs.</span>
<h2 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig04">VBA function sunrise()</a></h2>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/sunrise.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The
'portable' spreadsheet above will work on almost any program, but it is
inconvenient if you want to make a table of sunset or sunrise times.
Most modern business spreadsheets have a macro language built into
them, and Microsoft Excel comes with Visual Basic for Applications. The
VBA code below defines a range of 'user functions' including;</p>
<ul style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<li>degree based trig functions</li><li><tt>days2000(year, month, day, hour, minute, second, optional greg)</tt><span>&nbsp;</span>which
returns the number of days since J2000.0 for a given instant. This
function is valid for negative years and far into the future, unlike
the simple one line function used in the 'portable' spreadsheet above.
The optional argument 'greg' uses the Julian calendar if set to 0, and
the gregorian if set to 1 or not used. This allows for countries like
England and Sweeden, who did not adopt the Gregorian calendar in 1582.</li><li><tt>sunrise(days, glat, glong, index, optional altitude)</tt><span>&nbsp;</span>which
returns the time of a rising or setting event. Index = +1 gives a
rising event, index = 2 gives a setting event. The optional argument
altitude allows you to specify the altitude you want the Sun to have,
i.e. a value of -12 for altitude and +1 for index will give you the
time when the night brightens to astronomical twilight.</li>
</ul>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">An Excel 95 spreadsheet which contains a simple example of the use of<span>&nbsp;</span></span><tt style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Sunrise()</tt><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;"><span>&nbsp;</span>is<span>&nbsp;</span></span><a href="http://www.stargazing.net/kepler/sunrise.zip" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">available for download</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">. There are instructions about how to add the VBA code below to an Excel spreadsheet after the code listing.</span>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">'   define some numerical constants - these are not<br>'   accessible in the spreadsheet.<br><br>Public Const pi As Double = 3.14159265358979<br>Public Const tpi As Double = 6.28318530717958<br>Public Const degs  As Double = 57.2957795130823<br>Public Const rads As Double = 1.74532925199433E-02<br><br>'   The trig formulas working in degrees. This just<br>'   makes the spreadsheet formulas a bit easier to<br>'   read. DegAtan2() has had the arguments swapped<br>'   from the Excel order, so the order matches most<br>'   textbooks<br><br>Function DegSin(x As Double) As Double<br>    DegSin = Sin(rads * x)<br>End Function<br><br>Function DegCos(x As Double) As Double<br>    DegCos = Cos(rads * x)<br>End Function<br><br>Function DegTan(x As Double) As Double<br>    DegTan = Tan(rads * x)<br>End Function<br><br>Function DegArcsin(x As Double) As Double<br>    DegArcsin = degs * Application.Asin(x)<br>End Function<br><br>Function DegArccos(x As Double) As Double<br>     DegArccos = degs * Application.Acos(x)<br>End Function<br><br>Function DegArctan(x As Double) As Double<br>    DegArctan = degs * Atn(x)<br>End Function<br><br>Function DegAtan2(y As Double, x As Double) As Double<br>'   this returns the angle in the range 0 to 360<br>'   instead of -180 to 180 - and swaps the arguments<br>'   This format matches Meeus and Duffett-Smith<br>    DegAtan2 = degs * Application.Atan2(x, y)<br>    If DegAtan2 &lt; 0 Then DegAtan2 = DegAtan2 + 360<br>End Function<br><br>Private Function range2pi(x)<br>'<br>'   returns an angle x in the range 0 to two pi rads<br>'   This function is not available in the spreadsheet<br>'<br>range2pi = x - tpi * Int(x / tpi)<br>End Function<br><br>Private Function range360(x)<br>'<br>'   returns an angle x in the range 0 to 360<br>'   used to prevent the huge values of degrees<br>'   that you get from mean longitude formulas<br>'<br>'   this function is private to this module,<br>'   you won't find it in the Function Wizard,<br>'   and you can't use it on a spreadsheet.<br>'   If you want it on the spreadsheet, just remove<br>'   the 'private' keyword above.<br>'<br>range360 = x - 360 * Int(x / 360)<br>End Function<br><br>Function degdecimal(d, m, s)<br>'   converts from dms format to ddd format degdecimal = d + m / 60 + s / 3600<br>End Function<br><br><br>Function day2000(year As Integer, month As Integer, day As Integer,<br>hour As Integer, _<br> min As Integer, sec As Double, Optional greg) As Double<br> '  returns days before J2000.0 given date in gregorian calender (greg=1)<br> '  or julian calendar (greg = 0). If you don't provide a value for greg,<br> '  then assumed Gregorian calender<br>    Dim a As Double<br>    Dim b As Integer<br>    If (IsMissing(greg)) Then greg = 1<br>    a = 10000# * year + 100# * month + day<br>    If (month &lt;= 2) Then<br>        month = month + 12<br>        year = year - 1<br>    End If<br>    If (greg = 0) Then<br>        b = -2 + Fix((year + 4716) / 4) - 1179<br>    Else<br>        b = Fix(year / 400) - Fix(year / 100) + Fix(year / 4)<br>    End If<br>    a = 365# * year - 730548.5<br>    day2000 = a + b + Fix(30.6001 * (month + 1)) + day + (hour + min /60 + sec / 3600) / 24<br>End Function<br><br>Function Sunrise(ByVal day As Double, _<br>    glat As Double, glong As Double, index As Integer, _<br>    Optional altitude) As Double<br>    <br>'   Takes the day number of 0h UT on a given day, and returns the<br>'   time of sunrise or set according to index 1 or 2. The optional<br>'   argument can be used to give an arbitrary value for the altitude<br>'   of the Sun. The default value corresponds to the top limb of the<br>'   Sun touching the mathematical horizon, allowing for refraction<br>'   at sea level. Method from 9.311 and 9.33 of the Explanatory<br>'   Suppliment to the Astronomical Almanac (Seidelmann, 1992).<br>    <br>Dim sinalt As Double, gha As Double, lambda As Double, delta As Double, _<br>t As Double, c As Double, days As Double, utold As Double, utnew As Double, _<br>sinphi As Double, cosphi As Double, _<br>L As Double, G As Double, E As Double, obl As Double, signt As Double, _<br>act As Double<br><br>If (IsMissing(altitude)) Then altitude = -0.833<br>utold = 180   'initial value finds first position at 12h UT on day<br>utnew = 0<br>sinalt = Sin(altitude * rads) 'go for the sunrise/sunset altitude first<br>sinphi = DegSin(glat)<br>cosphi = DegCos(glat)<br>If index = 1 Then signt = 1 Else signt = -1<br>Do While Abs(utold - utnew) &gt; 0.1<br>    utold = utnew   'carry forward the iteration<br>    days = day + utold / 360    'update the arguments for sun's position<br>    t = days / 36525<br>'   find sun's coordinates<br>    L = range360(280.46 + 36000.77 * t)<br>    G = 357.528 + 35999.05 * t<br>    lambda = L + 1.915 * DegSin(G) + 0.02 * DegSin(2 * G)<br>    E = -1.915 * DegSin(G) - 0.02 * DegSin(2 * G) + 2.466 * DegSin(2 * lambda) - 0.053 * DegSin(4 * lambda)<br>    obl = 23.4393 - 0.13 * t<br>'   update the hour angle and declination of the Sun<br>    gha = utold - 180 + E<br>    delta = DegArcsin(DegSin(obl) * DegSin(lambda))<br>'   calculate the correction term for this loop<br>    c = (sinalt - sinphi * DegSin(delta)) / (cosphi * DegCos(delta))<br>    act = DegArccos(c)<br>    If c &gt; 1 Then act = 0<br>    If c &lt; -1 Then act = 180<br>'   find the newly corrected ut for sunrise/set<br>    utnew = range360(utold - (gha + glong + signt * act))<br>Loop<br>Sunrise = utnew<br>End Function<br></pre>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">To add these user defined functions to your spreadsheet, you should;</p>
<ul style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<li>Keep this page open in your browser</li><li>In the browser window, highlight all the text between the rows of * below</li><li>Select<span>&nbsp;</span><b>Edit | Copy</b><span>&nbsp;</span>from the browser<span>&nbsp;</span><b>Edit</b><span>&nbsp;</span>menu</li><li>open Excel 95 with a blank workbook</li><li>click on the<span>&nbsp;</span><b>Insert</b><span>&nbsp;</span>menu and select<span>&nbsp;</span><b>Insert | Macro | Module</b>.<br>A new module window should appear</li><li>click in the new VBA module window, and select<span>&nbsp;</span><b>Edit | Paste<span>&nbsp;</span></b>from the Excel<span>&nbsp;</span><b>edit</b><span>&nbsp;</span>menu</li><li>Save the new workbook</li><li>Switch to a blank worksheet, and type the formula<span>&nbsp;</span><code>=day2000(1998,10,25,0,0,0)/36525</code><span>&nbsp;</span>into a cell, then press enter.<br>The cell value should be<span>&nbsp;</span><code>-0.01186858316</code>, i.e. the number of centuries since J2000.0 for 0h 1998 October 25th</li>
</ul>
<h2 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig04a">QBASIC program</a></h2>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/sunrise.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">] For those who prefer a program to a spreadsheet, below is the<span>&nbsp;</span></span><code style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">QBASIC</code><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;"><span>&nbsp;</span>listing for a simple program which will prompt the user for;</span>
<ul style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<li>latitude (decimal degrees, North positive) of observer</li><li>longitude (decimal degrees, West negative)</li><li>time zone offset from Greenwich, West negative</li><li>rising or setting events (+1 for rise, -1 for set)</li><li>desired altitude for Sun (i.e. -12 is nautical twilight)</li><li>Year</li><li>Month</li><li>Day</li>
</ul>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">and print the time of the selected event. The program prints the time in hhmm 24 hour format using the function<span>&nbsp;</span></span><tt style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">FNdegmin$</tt><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">, re-cycled from my Burnham precession program.</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The easiest way to transfer the listing into QBASIC would be to;</p>
<ul style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<li>highlight (select) all the code betwen the lines of<span>&nbsp;</span><code>*******</code></li><li>copy this text to the clipboard (cntrol key and C)</li><li>paste the code into Notepad</li><li>save, setting the file type to<span>&nbsp;</span><code>All files (*.*)</code>, and using the file extension<span>&nbsp;</span><code>.BAS</code></li><li>Check
the file for broken lines, which occur if the browser window is set
less wide than the width of some of the wider lines of BASIC</li><li>Load resulting file into<span>&nbsp;</span><code>QBASIC</code><span>&nbsp;</span>or the FirstBas basic compiler.</li>
</ul>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">'********************************************************************<br>'   Sun rise/set /twilight<br>'   From Explanatory Supplement<br>'   definitions and functions<br>DEFDBL A-Z<br>pi = 4 * ATN(1)<br>tpi = 2 * pi<br>twopi = tpi<br>degs = 180 / pi<br>rads = pi / 180<br>'<br>'   the function below returns the true integer part,<br>'   even for negative numbers<br>'<br>DEF FNipart (x) = SGN(x) * INT(ABS(x))<br>'<br>'   FNday only works between 1901 to 2099 - see Meeus chapter 7<br>'<br>DEF FNday (y, m, d, h) = 367 * y - 7 * (y + (m + 9) \ 12) \ 4 + 275 * m \ 9 + d - 730531.5 + h / 24<br>'<br>'   define some arc cos and arc sin functions<br>'<br>DEF FNacos (x)<br>    s = SQR(1 - x * x)<br>    FNacos = ATN(s / x)<br>END DEF<br>DEF FNasin (x)<br>    c = SQR(1 - x * x)<br>    FNasin = ATN(x / c)<br>END DEF<br>'<br>'   the function below returns an angle in the range<br>'   0 to two pi<br>'<br>DEF FNrange (x)<br>    b = x / tpi<br>    a = tpi * (b - FNipart(b))<br>    IF a &lt; 0 THEN a = tpi + a<br>    FNrange = a<br>END DEF<br>'<br>'       the function below returns the time in 24 hour<br>'   notation - hhmm - given a decimal hours figure.<br>DEF FNdegmin$ (d)<br>c = ABS(d)<br>a = INT(c)<br>b = 60 * (c - a)<br>d$ = STR$(INT(a * 100 + b + .5))<br>d$ = RIGHT$(d$, LEN(d$) - 1)<br>WHILE LEN(d$) &lt; 4<br>    d$ = "0" + d$<br>WEND<br>FNdegmin$ = d$<br>END DEF<br>CLS<br>'<br>'    get the date and geographical position from user<br>'<br>INPUT "     lat : ", glat<br>INPUT "    long : ", glong<br>INPUT "    zone : ", zone<br>INPUT "rise/set : ", riset<br>INPUT " Sun alt : ", altitude<br>INPUT "   year  : ", y<br>INPUT "   month : ", m<br>INPUT "   day   : ", d<br>day = FNday(y, m, d, 0)<br>PRINT "  day no : "; day<br>utold = pi<br>utnew = 0<br>sinalt = SIN(altitude * rads) 'go for the sunrise/sunset altitude first<br>sinphi = SIN(glat * rads)<br>cosphi = COS(glat * rads)<br>glong = glong * rads<br>DO WHILE ABS(utold - utnew) &gt; .001<br>  utold = utnew<br>  days = day + utold / tpi<br>  t = days / 36525<br>  '     get arguments of Sun's orbit<br>  L = FNrange(4.8949504201433# + 628.331969753199# * t)<br>  G = FNrange(6.2400408# + 628.3019501# * t)<br>  ec = .033423 * SIN(G) + .00034907# * SIN(2 * G)<br>  lambda = L + ec<br>  E = -1 * ec + .0430398# * SIN(2 * lambda) - .00092502# * SIN(4 * lambda)<br>  obl = .409093 - .0002269# * t<br>  delta = FNasin(SIN(obl) * SIN(lambda))<br>  GHA = utold - pi + E<br>  cosc = (sinalt - sinphi * SIN(delta)) / (cosphi * COS(delta))<br>  SELECT CASE cosc<br>  CASE cosc &gt; 1<br>    correction = 0<br>  CASE cosc &lt; -1<br>    correction = pi<br>  CASE ELSE<br>    correction = FNacos(cosc)<br>  END SELECT<br>  utnew = FNrange(utold - (GHA + glong + riset * correction))<br>LOOP<br>PRINT "    UT   : "; FNdegmin$(utnew * degs / 15)<br>PRINT "   zone  : "; FNdegmin$(utnew * degs / 15 + zone)<br>END<br>'******************************************************************<br></pre>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Below
is the input and output of the program given the example case used
throughout this page, sunrise on 1998 October 25th at Birmingham UK.</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">    lat : 52.5<br>   long : -1.9167<br>   zone : 0<br>ise/set : 1<br>Sun alt : -0.833<br>  year  : 1998<br>  month : 10<br>  day   : 25<br> day no : -433.5<br>   UT   : 0651<br>  zone  : 0651<br></pre>
<h2 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig05">References</a></h2>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/sunrise.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Seidelmann, P. Kenneth (ed)<br><i>Explanatory Supplement to the Astronomical Almanac</i><br>University Science Books<br>1992, completely revised<br>ISBN 0-935702-68-7</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Definitive reference on all aspects of the<span>&nbsp;</span><cite>ephemeris
and associated calculations. No hostages taken, no example calculations
and modern vectoral notation used throughout. Relevant sections are
9.311 (p484) and 9.33 (p486).</cite></p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a href="http://193.12.249.96/pausch/comp/ppcomp.html">http://193.12.249.96/pausch/comp/ppcomp.html</a></p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Paul
Schlyter's page contains a restatement of a method similar to the one
used here, but applicable to his planetary and lunar positions method.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">[<a href="http://www.stargazing.net/kepler/index.html#top">Root</a>]</p>
<hr style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">Last Modified 1999 May 30th</span><br style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">Keith Burnett</span><br style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<address style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">keith@xylem.demon.co.uk</address>
<br class="Apple-interchange-newline">


</body></html>