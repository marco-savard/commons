<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head><meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"><title>kepler</title></head><body><img src="http://www.stargazing.net/kepler/banner.gif" alt="" style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;" border="0" height="30" width="400"><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;"></span>
<h1 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig00">Kepler's equation and the Equation of Centre</a></h1>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/index.html" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Root</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<h2 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Contents</h2>
<ul style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<li><a href="http://www.stargazing.net/kepler/kepler.html#twig01">Overview</a></li><li><a href="http://www.stargazing.net/kepler/kepler.html#twig01a">Simple iterative method</a><span>&nbsp;</span><tt>(added 1st Nov 98)</tt></li><li><a href="http://www.stargazing.net/kepler/kepler.html#twig02">Kepler's equation using Netwon's Method</a></li><li><a href="http://www.stargazing.net/kepler/kepler.html#twig03">Equation of Centre to 3rd power of eccentricity</a></li><li><a href="http://www.stargazing.net/kepler/kepler.html#twig04">Equation of Centre to 5th power of eccentricity</a></li><li><a href="http://www.stargazing.net/kepler/kepler.html#twig07">Errors for the planets</a></li><li><a href="http://www.stargazing.net/kepler/kepler.html#twig08">Books</a></li>
</ul>
<h2 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig01">Overview</a></h2>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/kepler.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><em>'Since
I was aware that there exists an infinite number of points on the orbit
and accordingly an infinite number of distances [from the Sun] the idea
occured to me that the sum of these distances is contained in the</em><span>&nbsp;</span>area<span>&nbsp;</span><em>of
the orbit. For I remembered that in the same manner Archimedes too
divided the area of a circle into an infinite number of triangles'</em><br>-Kepler</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">This
page deals with the problem of finding the true anomaly for a planet in
an elliptical orbit around the Sun. I describe three methods for
finding the true anomaly from the mean anomaly and the eccentricity of
the orbit;</p>
<ul style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<li>simple iteration</li><li>Newton's method</li><li>the Equation of Centre series expansion in powers of the eccentricity</li>
</ul>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">If
you can stand an error of half a minute in longitude for Mercury, then
the series to the 5th power of the eccentricity will be useable for all
the major planets except Pluto. The series to the 3rd power in the
eccentricity gives an error in longitude of less than one arcsecond for
the Earth. The series approximation has the advantage of direct use in
a spreadsheet without any iteration.</p>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Some theory</h3>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Kepler's
law of areas states that the area swept out by the radius vector of a
planet in orbit around the sun is constant for equal periods of time.
Given that the orbit for a single planet around a single massive Sun is
an ellipse, this means that the planet speeds up near perihelion and
slows down near aphelion.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">If
you want to find the position of a planet in the sky, then you need to
find the position of the planet in its own orbit. You need a way of
working out the<span>&nbsp;</span><em>longitude</em><span>&nbsp;</span>of the planet in its orbit at each instant.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">In more precise terms, we want to find the<span>&nbsp;</span><em>true anomaly</em><span>&nbsp;</span>(v) in terms of the<span>&nbsp;</span><em>mean anomaly</em><span>&nbsp;</span>(M).</p>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">True anomaly</h3>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">If
the Sun is at one focus of the ellipse (f) and the planet is at a
position (P), and perihelion (A), then the true anomaly is the angle
AfP.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><img src="http://www.stargazing.net/kepler/k1.gif" alt="diagram for true anomaly" height="146" width="230"></p>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Mean anomaly</h3>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">If
we imagine a small circle within the orbit, and centred on the focus f,
then the mean anomaly is the angle between the perihelion A, the focus
f and the position the planet would occupy if it was travelling at a
constant angular speed - say P1.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The mean anomaly is easily worked out from the daily motion (n) given in the orbital elements in the Astronomical Almanac.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">There is no obvious way to relate these two motions - but Kepler introduced a third quantity called the<span>&nbsp;</span><em>eccentric anomaly</em>.</p>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Eccentric anomaly</h3>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Imagine
a large circle of radius equal to the semi- major axis of the orbit.
Let the centre of this circle be at C. Now on the diameter of the
circle which passes through the long axis of the ellipse, raise a
perpendicular which meets the planet at P on the ellipse. Continue this
perpendicular until it crosses the large circle. Call the point where
the perpendicular crosses the large circle Q. Then the angle QCf is the
eccentric anomaly E.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><img src="http://www.stargazing.net/kepler/k3.gif" alt="Diagram for eccentric anomaly" height="299" width="291"></p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Kepler knew the two following relations;</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">E - e sin E = M     (kepler's equation)<br><br>tan(V/2) = sqr((1 + e)/(1 - e)) * tan(E/2)<br></pre>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The second formula is easy to evaluate if you know the eccentric anomaly E. The first equation is<span>&nbsp;</span><em>much</em><span>&nbsp;</span>harder to solve, as the unknown appears twice, once in a trigonometric function.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">There
are two main strategies - solve Kepler's equation by an iterative or
trial and error method, or obtain a series for the true anomaly in
terms of the mean anomaly, expanding in higher powers of the
eccentricity. This latter method has become known as the 'equation of
the centre'. For a full derivation of the geometry above, see<span>&nbsp;</span><cite>Smart, Chapter 5, sections 67 -71</cite>.</p>
<h2 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig01a">Simple iterative method</a></h2>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/kepler.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">We can solve Kepler's equation using an<span>&nbsp;</span><em>iterative</em><span>&nbsp;</span>procedure.
In an iterative procedure, we make an initial guess, use an iteration
formula to obtain an improved estimate of the eccentric anomaly, and
then feed the new value into the iteration formula again to get a
better guess. We stop when two successive extimates for the eccentric
anomaly are equal in value to the desired accuracy. We then use the
formula given above to calculate the true anomaly.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">For Kepler's equation, we can use the following scheme;</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">                  E0 = M<br>                  E1 = M + ec * sin(E0)<br>                  E2 = M + ec * sin(E1)<br>                  E3 = M + ec * sin(E2)<br>                  <br>                  and so on until successive estimates for E<br>                  differ by less than 0.000001 radians.<br></pre>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Setting
up a spreadsheet to produce these successive approximations is fairly
straight forward, and for Mercury (eccentricity 0.205635 from one set
of osculating elements), and a mean anomaly 1.2 radians, we get the
following series of approximations;</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">                 ec  0.205635<br>                 M   1.2<br>                 E1  1.391660<br>                 E2  1.402344<br>                 E3  1.402724<br>                 E4  1.402737<br>                 E5  1.402738<br>                 E6  1.402738<br>                 E7  1.402738<br></pre>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">By
the sixth iteration, the eccentric anomaly estimates coincide to within
0.0000001 radians. The formulas below should copy and paste directly
into a spreadsheet in cells B1:B9;</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">0.205635<br>1.2<br>=$B$2+$B$1*SIN(B2)<br>=$B$2+$B$1*SIN(B3)<br>=$B$2+$B$1*SIN(B4)<br>=$B$2+$B$1*SIN(B5)<br>=$B$2+$B$1*SIN(B6)<br>=$B$2+$B$1*SIN(B7)<br>=$B$2+$B$1*SIN(B8)<br></pre>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">Notice
the absolute referencing on eccentricity ($B$1) and mean anomaly
($B$2). In other spreadsheets, you may have to use the @ symbol or the
+ infront of the formulas instead of the =.</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">This
iterative method can require a large number of iterations to converge
to a good estimate for high values of the eccenricity. As an extreme
example, below is some data for eccentricity = 0.999 and a mean anomaly
of 150 degrees (converted to radians);</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">ec  0.999<br>M   2.617993878<br>E1  3.117494<br>E2  2.642066<br>E3  3.096525<br>E4  2.663001<br>E5  3.078062<br>E6  2.681418<br>E7  3.061654<br>E8  2.697767<br>E9  3.046962<br>E10 2.712389<br>E11 3.033725<br>E12 2.725545<br>E13 3.021738<br>E14 2.737442<br>E15 3.010838<br>E16 2.748245<br>E17 3.000893<br>E18 2.758090<br>E19 2.991791<br>E20 2.767087<br>E21 2.983441<br></pre>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">As
you can see, the successive estimates of eccentric anomaly are
converging to two slightly different values - this is a hallmark of
chaos, and indeed Kepler's equation is similar to the<span>&nbsp;</span><em>logistic equation</em>.
For the nine planets, these considerations don't apply, and the method
will always converge to within a millionth of a radian within 8
iterations at most. See Meeus' book for more detail on the convergence
of this and Newton's method.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Some
spreadsheets allow 'circular references' in cell formulas. This means
that you can have a formula in a cell which contains a reference to the
cell which the formula is in! Microsoft Excel allows this, and gives
you a section in the<span>&nbsp;</span><b>Tools | Options | Calculation</b><span>&nbsp;</span><a href="http://www.stargazing.net/kepler/excelc.gif">dialog box</a><span>&nbsp;</span>in the<span>&nbsp;</span><b>iteration</b><span>&nbsp;</span>section
(bottom right) for controlling the maximum number of iterations, and
maximum change of two successive estimates. The default settings appear
to be 100 iterations and 0.000001 change between estimates. This allows
us to use a very simple formula to solve Kepler's equation - copy the
following three lines to cells A1 to A3 of MS Excel;</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">0.205635<br>1.2<br>=A2+A1*SIN(A3)<br></pre>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The
value in cell A3 should converge to 1.402737872 radians for the
eccentric anomaly. This lends itself to producing an ephemeris for a
planet for successive weeks or days. Be warned that a spreadsheet with
a large number of these self referencing formulas can take a
significant time to recalculate when changed. You may find the
'equation of centre' preferable.</p>
<h2 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig02">Kepler's equation using Newton's method</a></h2>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/kepler.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top of page</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<ul style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<li><a href="http://www.stargazing.net/kepler/kepler.html#twig02e">Manual method</a></li><li><a href="http://www.stargazing.net/kepler/kepler.html#twig02a">Excel function for eccentric anomaly</a></li><li><a href="http://www.stargazing.net/kepler/kepler.html#twig02b">QBASIC function for true anomaly</a></li><li><a href="http://www.stargazing.net/kepler/kepler.html#twig02c">TI-80 sub-program for true anomaly</a></li><li><a href="http://www.stargazing.net/kepler/kepler.html#twig02d">Convergence at high values of eccentricity</a></li>
</ul>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig02e">Manual Method</a></h3>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/kepler.html#twig02" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top of section</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">In
these days of cheap programmable calculators, you can find the true
anomaly from the mean anomaly and the eccentricity by solving Kepler's
equation by iteration.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">A
solution to Kepler's equation gives you the 'eccentric anomaly' (E) for
the planet in an orbit of given eccentricity (ecc). You can then find
the true anomaly (v) from the formula;</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">tan(V/2) = sqr((1 + ecc)/(1 - ecc)) * tan(E/2)<br></pre>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">An
efficient iteration scheme for solving Kepler's equation for the
eccentric anomaly uses Newton's Method - and a 'manual' calculation
scheme is detailed below (after<span>&nbsp;</span><cite>Duffett- Smith, section 47</cite>).</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">All angles assumed in radians<br><br>To solve E - ec*sin(E) = M<br><br>eps = precision parameter, 10E-7 usually OK for<br>ten digit calculators, use 10E-5 if working by hand!<br><br>1)  Put E = E0 = M  (1st guess)<br><br>2)  Find the value of d = E - ec * sin(E) - M<br><br>3)  If abs(d) &lt; eps go to step 6<br><br>    else<br><br>    carry on to step 4<br><br>4)  find deltaE = d/(1 - ec * cos(E))<br><br>5)  take new guess for E as E1 = E - deltaE<br><br>    go to step 2<br><br>6)  present value of E is correct within eps.<br><br>7)  find tan(V/2) = sqr((1 + ec)/(1 - ec)) * tan(E/2)<br><br>8)  find inverse tan, multiply by 2, and convert to degrees<br>    for true anomaly v<br></pre>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">The
procedure above provides correct values of the true anomaly, but can
take a large number of iterations, especially for large values of
eccentricity. The method becomes unstable for certain values of mean
anomaly and eccentricity above 0.99 - chaos looms! If you are
interested in comets, then a bisection search solution method might be
more stable.</span>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig02a">Excel function using VBA for eccentric anomaly</a></h3>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/kepler.html#twig02" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top of section</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Below
is a Visual Basic for Applications routine for returning the eccentric
anomaly (e) given the mean anomaly (m), the eccentricity (ecc) and the
precision parameter (eps). Note that eps is supplied as a positive
integer, and that the answer for eccentric anomaly will be within<span>&nbsp;</span><code>10^-eps</code><span>&nbsp;</span>of the true value.</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">Function kepler(m, ecc, eps)<br>'   solves the equation e - ecc*sin(e) = m for e given an m<br>'   returns a value of e given<br>'   m  -  the 'mean anomaly' in orbit theory<br>'   ecc - the eccentricity of the orbit<br>'   eps - the precision parameter - solution will be<br>'         within 10^-eps of the true value.<br>'         don't set eps above 14, as convergence can't be guaranteed<br>e = m                                       'first guess<br>delta = 0.05    'set delta equal to a dummy value<br><br>Do While Abs(delta) &gt;= 10 ^ -eps         'converged?<br>      delta = e - ecc * Sin(e) - m          'new error<br>      e = e - delta / (1 - ecc * Cos(e))    'corrected guess<br>Loop<br>kepler = e                                  'return estimate<br>End Function<br></pre>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">To
use the function above in Excel, you need to insert a new module into
your Excel workbook, and then copy the text into the blank module
window. Within that workbook, you can then use<span>&nbsp;</span><code>kepler()</code><span>&nbsp;</span>just like any other function.</p>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig02b">Qbasic routine for true anomaly</a></h3>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/kepler.html#twig02" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top of section</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The<span>&nbsp;</span><code>QBASIC</code><span>&nbsp;</span>function
below returns the true anomaly (v) when given the mean anomaly (m), the
eccentricity of the orbit (ecc) and a precision parameter (eps). The
similarity in syntax between this<span>&nbsp;</span><code>QBASIC</code><span>&nbsp;</span>function and the Visual Basic for Applications function above is obvious - you can 'testbed' ideas in<span>&nbsp;</span><code>QBASIC</code><span>&nbsp;</span>and transfer them to Excel later.</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">FUNCTION kepler (m, ecc, eps)<br>'   returns the true anomaly given<br>'   m - the mean anomaly in radians<br>'   ecc - the eccentricity of the orbit<br>'   eps - the convergence paramter (8 or 9 is usually fine<br>'         12 or 14 for very accurate work)<br>e = m<br>delta = .05#<br>twopi = 8 * ATN(1)<br>DO WHILE ABS(delta) &gt;= 10 ^ -eps<br>      delta = e - ecc * SIN(e) - m<br>      e = e - delta / (1 - ecc * COS(e))<br>LOOP<br>v = 2 * ATN(((1 + ecc) / (1 - ecc)) ^ .5 * TAN(.5 * e))<br>IF v &lt; 0 THEN v = v + twopi<br>kepler = v<br>END FUNCTION<br></pre>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig02c">TI-80 program for true anomaly</a></h3>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/kepler.html#twig02" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top of section</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The
TI-80 programmable calculator is a cheap basic machine with about 6K of
memory. That does not sound much (about one Windows icon!) but it is
enough to program a whole series of astronomical routines. Similar
machines are available in the Cassio and Sharp range, and most cost
less than 30 Pounds Sterling.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The TI-80 programming language has a very simple syntax, and loops are constructed using the<span>&nbsp;</span><code>goto label</code><span>&nbsp;</span>method.
However, it is possible to call programs from within other programs, so
some kind of structured approach is possible. All variables are global
- and you only have 26 memories (<code>A</code><span>&nbsp;</span>to<span>&nbsp;</span><code>Z</code>) and six 'lists' each of which can hold 100 numbers.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The sub-program below will return a value for the true anomaly in memory<span>&nbsp;</span><code>V</code>, given the eccentricity of the orbit in memory<span>&nbsp;</span><code>A</code>, and the mean anomaly in memory<span>&nbsp;</span><code>M</code>.</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">Conventions used in listing<br><br>The TI-80 screen has a 'proper' pi symbol - I use 'pi'<br>to represent the circle constant here.<br><br>I use 'TAN-1' here to mean 'inverse tan' function, again<br>the TI-80 has a better screen representation of this.<br><br>I have added comments on most lines - of course there<br>is NO comment function on the TI-80!<br><br>I use the symbol --&gt; to stand for the assignment<br>arrow. In TI-80 language, assignment is done 'right to left'<br>so that 'A --&gt; B' assigns the value of memory A to <br>memory B.<br><br>PROGRAM:ZKEPLER<br>:pi * M/180 --&gt;B     'first guess set to eccentric anomaly<br>                        'store mean anom in B as rads for later<br>:RADIAN                 'runs rest of routine in radians<br>:LBL 1                  'label 1 - target for a later goto 8-{<br>:E - A * SIN(E) - B --&gt; X    'find difference<br>:IF ABS(X) &lt;= 0.0000001 goto 2  'quit loop if converged<br>:E - x/(1 - A * COS(E)) --&gt; E    'new value of E<br>:GOTO 1                 'loop for next iteration<br>:LBL 2                  'target for goto in loop<br>:2 * TAN-1(((1+A)/(1-A))^0.5 * TAN(E/2)) --&gt; V<br>:V * 180/pi --&gt; V    'convert V back to degrees<br>:DEGREE                 'switch back to degree mode<br>:RETURN                 'back to calling program<br></pre>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig02d">Convergence of Newton's method</a></h3>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/kepler.html#twig02" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top of section</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Newton's
method for iterative solution of equations is a standard technique and
you will find accounts of the method in most books on numerical
analysis see<span>&nbsp;</span><cite>Numerical Recipes in C, section 9.4</cite><span>&nbsp;</span>for example.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">For certain kinds of function, the method either does not converge, or generates<span>&nbsp;</span><em>very</em><span>&nbsp;</span>large values before converging. Large values can 'overflow' calculators and computers.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">In
the case of Kepler's equation, the iterative routines shown here
converge very rapidly - within a maximum of 8 loops - for all values of
eccentricity less than about 0.99. Above this value of eccentricity,
and for certain values of mean anomaly, there will be problems with
convergence, especially with the 10 decimal digit accuracy on the
TI-80. The VBA and<span>&nbsp;</span><code>QBASIC</code><span>&nbsp;</span>routines work in 'double precision' and will normally converge over a large range of eccentricity.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><cite>Meeus (page 189, table 29.B)</cite><span>&nbsp;</span>gives
a set of test data for his HP-85 computer (nostalgia!) and finds that
he needs 47 steps to obtain convergence in an orbit with eccentricity
of 0.999, and a mean anomaly of 7 degrees. Both the VBA and the<span>&nbsp;</span><code>QBASIC</code><span>&nbsp;</span>routines handled this case, but the TI-80 gave an overflow error on iteration 53 with<span>&nbsp;</span><code>E = 2 * 10^9</code>. Your mileage may vary.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">To
repeat my earlier comment, if you are working with orbits of
eccentricity above 0.9, it would be best to use a bisection search
method, or even use a parabolic orbit approximation.</p>
<h2 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig03">Equation of Centre to 3rd power of eccentricity</a></h2>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/kepler.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The<span>&nbsp;</span><cite>equation of centre</cite><span>&nbsp;</span>seems
to be the name given to series which give an approximation to the true
anomaly directly in terms of the mean anomaly. These series are power
series in the eccentricity, and trigonometric series in multiples of
the mean anomaly.<span>&nbsp;</span><cite>Smart Chapter V, sections 72, 73</cite><span>&nbsp;</span>gives
a derivation for the series form of the equation of centre. This
derivation seems quite complex, and I shall try to find a simpler one
when I have time for some real maths!</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The<span>&nbsp;</span><cite>Astronomical Almanac</cite><span>&nbsp;</span>gives the following version of the equation of centre to the third power in eccentricity - see page E4 in the 1997 issue.</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">v = M + (2e - 0.25*e^3)*sin(M) + 1.25*e^2*sin(2*m) + 13/12* e^3* sin(3*M)<br>where all angles are in radians<br></pre>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">I rearranged the series as a polynomial in the eccentricity (for any given calculation, the<span>&nbsp;</span><code>sin</code><span>&nbsp;</span>terms are constants) and used an old trick for evaluating polynomials without finding powers directly - (see<span>&nbsp;</span><cite>Meeus, Chapter 1, page 11</cite><span>&nbsp;</span>or<span>&nbsp;</span><cite>Numerical Recipes in C, 5.3</cite>). The resulting<span>&nbsp;</span><code>QBASIC</code><span>&nbsp;</span>is shown below;</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">FUNCTION kep3a (m, e, eps)<br>'uses the equation of centre in the Astronomical Almanac 1997<br>'page E4 as modified to make it more efficient<br>m1 = SIN(m)<br>m2 = SIN(2 * m)<br>m3 = SIN(3 * m)<br>a1 = 2 * m1<br>a2 = 1.25 * m2<br>a3 = -.25 * m1 + 1.083333333# * m3<br>kep3a = m + e * (a1 + e * (a2 + e * a3))<br>END FUNCTION<br></pre>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">You could probably save the<span>&nbsp;</span></span><code style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">m2</code><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;"><span>&nbsp;</span>variable, but keeping it makes the listing a bit clearer.</span>
<h2 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig04">Equation of Centre to 5th power of eccentricity</a></h2>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/kepler.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">A series expansion up to the 5th power in eccentricity gives an approximation to the true anomaly in terms of the mean anomaly.<span>&nbsp;</span><cite>Meeus (Chapter 32, page 222)</cite><span>&nbsp;</span>gives the series for the<span>&nbsp;</span><em>difference</em><span>&nbsp;</span>between the mean anomaly M and the true anomaly v. I state the series for the true anomaly in radians;</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">v = M + (2 * e - 0.25 * e^3 + 5/96 * e^5) * sin(M)<br>      + (1.25 * e^2 - 11/24 * e^4) * sin(2*M)<br>      + (13/12 * e^3 - 43/64 * e^5) * sin(3*M)<br>      + 103/96 * e^4 * sin(4*M)<br>      + 1097/960 * e^5 * sin(5*M)<br></pre>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">And below is a<span>&nbsp;</span></span><code style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">QBASIC</code><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;"><span>&nbsp;</span>function
- I have re-arranged the formula to make the computation more
efficient. I have also used decimal approximations to the coefficients.
I have found no problems doing this, and the procedure saves a number
of divide operations.</span>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">FUNCTION kep5a (m, e, ep)<br>'   equation of centre with terms up to fifth power of<br>'   the eccentricity. Meeus p222.<br>'   needs 5 sin calls, 19 add/subtracts, 14 mults<br>'   per call.<br>s1 = SIN(m)<br>s2 = SIN(m + m)<br>s3 = SIN(m + m + m)<br>s4 = SIN(m + m + m + m)<br>s5 = SIN(m + m + m + m + m) 'probably going over the top here!<br>a1 = 2 * s1<br>a2 = 1.25 * s2<br>a3 = 1.083333333# * s3 - .25 * s1<br>a4 = 1.072916667# * s4 - .4583333333# * s2<br>a5 = .0520833333# * s1 - .671875# * s3 + 1.142708333# * s5<br>kep5a = m + e * (a1 + e * (a2 + e * (a3 + e * (a4 + e * a5))))<br>END FUNCTION<br></pre>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Using the<span>&nbsp;</span><code>QBASIC</code><span>&nbsp;</span>interpreter, double precision additions are marginally faster than multiplies, so I used repeated addition in the calls to the<span>&nbsp;</span><code>SIN</code><span>&nbsp;</span>function. This is probably pointless!</p>
<h2 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig07">Errors for the planets</a></h2>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/kepler.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">I wrote a simple<span>&nbsp;</span><code>QBASIC</code><span>&nbsp;</span>program
to compare the values of true anomaly produced using the two versions
of the Equation of Centre with the values obtained from the iterative
solution to Kepler's equation. I found the value of the true anomaly
produced by each method for each degree of mean anomaly for values of
mean anomaly from 0 degrees up to 180 degrees.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The 'error' for each version of the Equation of Centre is defined as 'kepler - Eq Centre' and is expressed in<span>&nbsp;</span><em>arcseconds</em>.
The program kept the largest value of error seen for each of the two
series. In the table below, c3 represents the error from using the 3rd
power of eccentricity, and c5 is the error for the 5th power of
eccentricity.</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">Maximum errors in true anomaly arcseconds<br>                   <br>        Eccen       c3      c5<br>Venus   0.006773    0       0<br>Uranus  0.008606    0       0<br>Sun     0.016709    0       0<br>Neptune 0.047318    1       0<br>Jupiter 0.048489    2       0<br>Moon    0.054900    3       0<br>Saturn  0.055546    3       0<br>Mars    0.093405   23       0<br>Mercury 0.205635  540      35<br></pre>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">As
you can see from the table, Mars and Mercury are the two planets most
liable to errors in true anomaly by the use of the Equation of centre.
If you want to produce a simple program to find the positions of the
planets in the sky, then the c3 series will probably be useable, but
positions for Mercury may be in error by 9 minutes of arc.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Newton's
method may be expected to take longer to calculate. The time taken for
each function call will also depend on the number of iterations which
are needed to converge to the precision value needed. I produced the
following comparative timings using a Pentium 75 MHz computer with
interpreted<span>&nbsp;</span><code>QBASIC</code><span>&nbsp;</span>running
in a DOS session window under Windows 95. The program evaluated the
true anomaly for each degree of mean anomaly between 0 degrees and 360
degrees, repeating the loop 10 times. Each function is called 3600
times, with a variety of input values. The Newton's method was set to a
precision of<span>&nbsp;</span><code>10^-12</code><span>&nbsp;</span>in all the runs below;</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">Time in seconds for 3600 function calls<br><br>                    eccentricity values<br>                  0.25   0.1   0.05   0.9<br>Newton's method  26.9   24.9  23.9   33.8<br>c5 series         8.3    8.3   8.4    8.5<br>c3 series         4.8    5.0   4.9    4.9<br><br>QBASIC - relative times may change on other interpreters<br>         and systems.<br></pre>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">As
might be expected each equation of centre series function took more or
less the same time to return a value irrespective of the value of the
eccentricity. The values for true anomaly returned by these functions
for eccentricities much over 0.25 will be very inaccurate.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The
Newton's method function takes about six times longer than the c3 power
series, and the time does depend on the value of eccentricity to some
extent, but less than might be expected. The true anomaly values
generated by this function will be accurate to<span>&nbsp;</span><code>10^-12</code><span>&nbsp;</span>of a radian.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">I
have chosen to use the Newton's Method function on my TI-80, but may
use the c5 series on a spreadsheet, as the series dispenses with the
need to use a 'macro' function.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">If
you need to squeeze the most speed from your programs, then using the
c3 series for the Sun/Earth orbit (which is needed to find geocentric
positions of any other body) may eliminate a call to the Kepler routine.</p>
<h2 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig08">Books</a></h2>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[</span><a href="http://www.stargazing.net/kepler/kepler.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Below
is a list of the books which I have used in compiling this page. These
books should be found in most University libraries in English speaking
countries.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Duffett-Smith, Peter<br><cite>Practical Astronomy with your calculator</cite><br>Cambridge University Press<br>3rd edition 1988<br>ISBN 0-521-35699-7</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Meeus, Jean<br><cite>Astronomical Algorithms</cite><br>Willmann-Bell<br>1st English edition, 1991<br>ISBN 0-943396-35-2</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Press, Flannery, Teukolsky, Vetterling<br><cite>Numerical recipes in C</cite><br>Cambridge University Press<br>1st ed 1988<br>ISBN 0-521-35465-X</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Smart, W,M,<br><cite>Text Book of Spherical Astronomy</cite><br>Cambridge University Press<br>6th ed<br></p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">[<a href="http://www.stargazing.net/kepler/index.html">Root</a>]</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Last Modified 1st November 1998<br>Keith Burnett<br></p>
<address style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">keith@xylem.demon.co.uk</address>
<br class="Apple-interchange-newline">

  

</body></html>