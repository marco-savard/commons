<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head><meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"><title>moonrise</title></head><body><img src="http://www.stargazing.net/kepler/banner.gif" alt="Approximate astronomical positions" style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;" border="0" height="30" width="400"><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;"></span>
<h1 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig00">Moon and Sun rise and set for any latitude</a></h1>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[<span>&nbsp;</span></span><a href="http://www.stargazing.net/kepler/index.html#top" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Root</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;"><span>&nbsp;</span>]</span>
<hr style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<h2 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Contents</h2>
<ul style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<li><a href="http://www.stargazing.net/kepler/moonrise.html#twig01">Overview</a><ul><li><a href="http://www.stargazing.net/kepler/moonrise.html#twig01a">Definitions and the problem</a></li><li><a href="http://www.stargazing.net/kepler/moonrise.html#twig01b">Different algorithms</a></li><li><a href="http://www.stargazing.net/kepler/moonrise.html#twig02">Quadratic interpolation method</a></li></ul></li><li><a href="http://www.stargazing.net/kepler/moonrise.html#twig03">QBASIC listing</a></li><li><a href="http://www.stargazing.net/kepler/moonrise.html#twig05">References</a></li>
</ul>
<h2 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig01">Overview</a></h2>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[<span>&nbsp;</span></span><a href="http://www.stargazing.net/kepler/moonrise.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;"><span>&nbsp;</span>]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">This
page describes an algorithm that will enable you to calculate the time
of Moon rise and set and Sun rise and set, as well as the twilight
times, for any latitude on the Earth's surface. The algorithm presented
here will warn you if the Moon or Sun remains above or below the
horizon all day (a definite possibility above latitudes of 66.5 degrees
North), or if the object does not rise or set within the day chosen
(the Moon will exhibit this behaviour on one day in each lunar cycle).</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">If you just want the<span>&nbsp;</span><em>results</em><span>&nbsp;</span>for your observing location, then I recommend the<span>&nbsp;</span><a href="http://aa.usno.navy.mil/aa/data/">Web page based programs</a><span>&nbsp;</span>provided
by the US Naval Observatory. One of these programs will give you a
compact yearly calendar style printout of rise and set times at a given
location on a single sheet of paper. I use a set of printouts in my own
observation planning - its easier than switching on the computer!</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">In the<span>&nbsp;</span><em>implementation</em><span>&nbsp;</span>of
the algorithm on this page, I have used approximate routines to
calculate the coordinates of the Sun and Moon. You can choose latitudes
where the program will predict a very short day when the Sun really
remains below the horizon all day - this inaccuracy affects latitudes
close to 67.43 degrees North, and you can imagine a 'fuzzy zone' around
the Earth at this latitude (and a mirror image one in the South) where
the program may be in error. I suspect that more accurate position
routines and better approximations for topocentric parallax, refraction
and the diameter of the Sun and Moon would shrink this 'fuzzy zone', at
the cost of increased complexity.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The algorithm is implemented in<span>&nbsp;</span><code>QBASIC</code>,
a well structured interpreted basic available free for Windows
computers, and easily adapted to Visual Basic syntax. The
implementation is based very closely on<span>&nbsp;</span><code>PASCAL</code><span>&nbsp;</span>routines taken from<span>&nbsp;</span><cite>Montenbruck and Pfleger</cite>.</p>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig01a">Definitions and the problem</a></h3>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[<span>&nbsp;</span></span><a href="http://www.stargazing.net/kepler/moonrise.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;"><span>&nbsp;</span>]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The rising and setting of the Sun and Moon is defined here to be the instant when the<span>&nbsp;</span><em>upper limb</em><span>&nbsp;</span>of
the object is seen to cross a mathematically flat horizon by an
observer at sea level. Real observing situations on land rarely
approach this idealised model, and for my uses calculating rise and set
times to the nearest minute is fine.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The following factors need to be addressed</p>
<ul style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<li>The Sun and Moon vary in position against the stars over a period
of one day - the Moon moves about 12 degrees per day on average.</li><li>There
are latitudes on Earth where the Sun and Moon can be above or below the
horizon for days at a time. The algorithm has to detect and report
these circumstances.</li><li>The time of Moonset will be about 50
minutes later each night after New Moon. There will be at least one day
in each lunation during which the Moon does not set, and one day where
the Moon does not rise. The algorithm must report these days.</li><li>You must calculate the altitude of the Sun and the Moon as seen by the observer on the<span>&nbsp;</span><em>surface</em><span>&nbsp;</span>of the Earth - allowing for parallax from the geocentric coordinates.</li><li>You must correct for the effects of atmospheric refraction (not relevant for the twilights).</li><li>You must allow for the size of the Sun or Moon's disc (except for the twilights).</li>
</ul>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">In<span>&nbsp;</span><cite>Montenbruck and Pfleger</cite>'s
approximate implementation, the last three points above boil down to
subtracting a single correction term from the geocentric altitude of
the Moon or Sun when looking for rise or setting events.</p>
<ul style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<li>Sunrise occurs when the centre of the Sun's disc is at a geocentric altitude of -50 arc minutes.</li><li>Moon rise occurs when the centre of the Moon's disc is at a geocentric altitude of +8 arc minutes.</li><li>Nautical twilight is defined to be when the centre of the Sun is at a geocentric altitude of -12 degrees.</li>
</ul>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The
large difference between the Moon and the Sun correction reflects the
much larger parallax effect on Moon positions - roughly 1 degree for
the Moon compared to 9 arc seconds for the Sun.</p>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig01b">Different algorithms</a></h3>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[<span>&nbsp;</span></span><a href="http://www.stargazing.net/kepler/moonrise.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;"><span>&nbsp;</span>]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Possible algorithms include:-</p>
<ul style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<li>Use a single position and calculate as for a star</li><li>Use a 'trial and improvement' or 'iterative' method</li><li>Use a table based interpolation method</li>
</ul>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">I
used the 'single position and calculate as for star' method on a
programmable calculator - the results for the Sun at moderate latitudes
were 20 minutes or so wrong. Given the state of the local horizon, this
was not much of a problem. This 'method' was very poor for the Moon,
almost worse than guessing from the number of days since New Moon.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The
'trial and improvement' method with allowance for refraction, parallax
and disc size is much better, and can give good results for the Sun for
latitudes below 65N. The method will mostly converge after a few
iterations - see the<span>&nbsp;</span><a href="http://www.stargazing.net/kepler/sunrise.html">spreadsheet implementation</a><span>&nbsp;</span>on this Web site, or<span>&nbsp;</span><a href="http://hotel04.ausys.se/pausch/comp/ppcomp.html">Paul Schlyter's page</a>.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Tral
and improvement methods get fiddly in situations where the object
remains above or below the horizon for a number of days, or where the
object does not set one day or the next.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">A
table based method could be very simple - just calculate the altitude
of the Moon for each minute of the day and find when the altitude
changes sign. There is your rising or setting event.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">This
simple table based method could detect the 'always above the horizon'
or 'always below the horizon' situations as the (corrected) altitude
would never change sign over the day. The method could also cope with
the Moon missing a rise or set each lunar cycle, but 'grazing'
situations, where the Sun never quite dips below the horizon, would be
more difficult as there would be no sign change in the altitudes. A
real program based on this system would be really slow, requiring at
worst case 1440 calculations of altitude for each object for each day.</p>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig02">Quadratic interpolation method</a></h3>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[<span>&nbsp;</span></span><a href="http://www.stargazing.net/kepler/moonrise.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;"><span>&nbsp;</span>]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Interpolation
based methods use a shorter table of altitudes - in my implementation
we use a table with a maximum of 12 rows - and fit a quadratic function
to each set of three altitudes in turn. We then use some GCSE algebra
to find the times when the quadratic crosses the X axis - has zero
altitude - and these times are candidates for a rising or setting
event. This system can also deal with the situation when the rising and
setting occur within the hour - the quadratic then has two zeros.
Finally, if the two zeros are the same, then there must be a 'grazing'
event in that interval, and the algorithm can detect the event.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The steps in the procedure are</p>
<ol style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<li>Calculate the sine of the altitude (corrected for refraction,
parallax and the limb radius) for the first three hours in the day.
Using the sine of the altitude saves some calculation and means that
the values will always be within the range +1 to -1.</li><li>Save sign of the altitude at 0h</li><li>Take
the values of the sine of the altitude for each set of three
consecutive hours, correct for the refraction, parallax and fit a
quadratic curve through these three points. See<span>&nbsp;</span><cite>Montenbruck and Pfleger</cite><span>&nbsp;</span>for algebra.</li><li>Calculate the 'discriminant' for the quadratic, and classify as<ul><li>No roots within the 2 hour interval - move onto the next 2 hour range and start from step 1</li><li>Two roots, one root within the interval - classify as rising or setting event and appropriate flag<ul><li>If two flags set, i.e. rising and setting events both found, go to step 5</li><li>If one flag set, then return to step 1 for next two hour interval, to search for remaining event.</li></ul></li><li>Two roots, both within the interval - set the rising and setting flags and go to step 5.</li><li>One root (i.e. both roots same) within interval - set both rising and setting flags and go to step 5.</li></ul></li><li>If
neither rise nor set flag is set, then warn user that object is 'always
above' or 'always below' horizon depending on the sign of the altitude
in step 2, and move onto next object or quit.</li><li>Print rise and set times, or message if one event missing in current day.</li><li>Move onto next object or quit.</li>
</ol>
<h2 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig03">QBASIC listing and test data</a></h2>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[<span>&nbsp;</span></span><a href="http://www.stargazing.net/kepler/moonrise.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;"><span>&nbsp;</span>]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">You can download the tested<span>&nbsp;</span><code>QBASIC</code><span>&nbsp;</span>code below. The<span>&nbsp;</span><code>QBASIC</code><span>&nbsp;</span>editor
insists on adding functions and subroutines to the end of the listing
in alphabetical order - which does not make reading the code any
easier. I have added comments in the 'main' program that should help
you link the code to the description of the algorithm above.</p>
<ul style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<li><a href="http://www.stargazing.net/kepler/riset.bas">Link to QBASIC code (12 K)</a><span>&nbsp;</span>(some long lines)</li><li><a href="http://www.stargazing.net/kepler/riset.zip">Code in ZIP file format (4 K)</a></li>
</ul>
<h3 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Test data</h3>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Below are some samples of program input and output, together with accurate results from Chris Marriott's<span>&nbsp;</span><a href="http://www.skymap.com/smp_eval.htm">SkyMap Pro 6.0</a><span>&nbsp;</span>and with a year 2000 calendar for the Sun, Moon and Nautical Twilight generated from the USNO web based program.</p>
<h4 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Case 1</h4>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Rise
and set times for today in Birmingham UK - simple case with no
ambiguities. Below is the dialogue with the QBASIC program. Times of
events are given in form<span>&nbsp;</span><code>hhmm</code>, and are UT times.</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">   Rise and set for Sun and Moon<br>   =============================<br><br>   Year (yyyy) - - - - - - - - :2000<br>   Month  (mm) - - - - - - - - :1<br>   Day    (dd) - - - - - - - - :3<br>   Time zone (East +) - - - -  :0<br>   Longitude (w neg, decimals) :-1.91667<br>   Latitude  (n pos, decimals) :52.5<br><br>   Moon<br>     501<br>    1409<br><br>   Sun<br>     818<br>    1606<br><br>   Nautical twilight<br>     653<br>    1731<br></pre>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Skymap
Pro gives the following times for the Sun and Moon on 2000 Jan 3 -
agreement is fine to nearest minute, except for Moonrise that rounds
the wrong way to give a result one minute different from the USNO
tables.</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">Sunrise and twilight<br>Date           Rise        Set         Naut Twi E    Naut Twi B  <br>03 Jan 2000    08:18:11    16:05:50    17:30:56      06:53:06 <br><br>Moonrise<br>Rise: 5h 0m 23s<br>Set: 14h 9m 18s<br></pre>
<h4 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Case 2</h4>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">For 1999 December 25th at a made up location of 0 Longitude, 67.43 latitude, the<span>&nbsp;</span></span><code style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">QBASIC</code><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;"><span>&nbsp;</span>program gives a 'day' lasting 8 minutes:</span>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">   Rise and set for Sun and Moon<br>   =============================<br><br>   Year (yyyy) - - - - - - - - :1999<br>   Month  (mm) - - - - - - - - :12<br>   Day    (dd) - - - - - - - - :25<br>   Time zone (East +) - - - -  :0<br>   Longitude (w neg, decimals) :0<br>   Latitude  (n pos, decimals) :67.43<br><br>   Moon<br>    1747<br>    1206<br><br>   Sun<br>    1156<br>    1204<br><br>   Nautical twilight<br>     747<br>    1613<br></pre>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Skymap
Pro shows that the Sun remains below the horizon for the whole of that
day at the latitude given. SkyMap Pro gives the altitude of the (centre
of) Sun at transit for this day as roughly 53 minutes below the
horizon. This implies an error of roughly 30 minutes in Sun position at
that time for the<span>&nbsp;</span><code>QBASIC</code><span>&nbsp;</span>program. This seems rather large and I will be puggling about with this a bit more.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">The Moon times and times for twilight are within a minute of those produced by SkyMap Pro. You might treat output from the<span>&nbsp;</span><code>QBASIC</code><span>&nbsp;</span>program presented here with caution for locations with latitudes between 67 and 68 North.</p>
<h4 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Case 3</h4>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">For Narvik in Norway (further North), the program gives correct results give or take a minute:-</p>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">   Rise and set for Sun and Moon<br>   =============================<br><br>   Year (yyyy) - - - - - - - - :2000<br>   Month  (mm) - - - - - - - - :1<br>   Day    (dd) - - - - - - - - :3<br>   Time zone (East +) - - - -  :1<br>   Longitude (w neg, decimals) :17.42<br>   Latitude  (n pos, decimals) :68.43<br><br>   Moon<br>     629<br>    1157<br><br>   Sun<br>    always below horizon<br><br>   Nautical twilight<br>     743<br>    1607<br></pre>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">SkyMap Pro gives</span>
<pre style="color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px;">Moon<br>Rise: 6h 27m 59s<br>Set: 11h 57m 47s<br><br>Date           Rise        Set         Naut Twi E    Naut Twi B  <br>03 Jan 2000    --:--:--    --:--:--    16:07:06      07:42:21    <br></pre>
<h2 style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-style: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a name="twig05">References</a></h2>
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">[<span>&nbsp;</span></span><a href="http://www.stargazing.net/kepler/moonrise.html#twig00" style="font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Top</a><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;"><span>&nbsp;</span>]</span>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Oliver Montenbruck and Thomas Pfleger,<br><i>Astronomy on the Personal Computer</i><br>Springer<br>1994, 3rd edition<br>ISBN 3-540-63521-1</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Section 3.8 of this book is the basis of the<span>&nbsp;</span><code>QBASIC</code><span>&nbsp;</span>listing here. I have translated the<span>&nbsp;</span><code>PASCAL</code><span>&nbsp;</span>routines into<span>&nbsp;</span><code>QBASIC</code><span>&nbsp;</span>one
by one. This book does not contain an exhaustive explanation of the
quadratic fit method, and the test data the authors provide will not
test all branches of the code. This book comes with a software disc
with all the<span>&nbsp;</span><code>PASCAL</code><span>&nbsp;</span>routines - but does not cover all the ground in, say, Meeus'<span>&nbsp;</span><cite>Astronomical Algorithms</cite>.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Sky
and Telescope's software pages contain listings in 'spaghetti basic'
that implement a similar method for the Sun and the Moon - there is a
clever fix used to avoid re-calculating positions for the Sun and Moon
up to 12 times each day at the cost of some increase in the 'fuzzy
zone' when the programs may predict a Sunrise and set when there is
none. The links below are to the<span>&nbsp;</span><code>BASICA</code><span>&nbsp;</span>listings.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a href="http://www.skypub.com/resources/software/basic/programs/sunup.bas">http://www.skypub.com/resources/software/basic/programs/sunup.bas</a></p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><a href="http://www.skypub.com/resources/software/basic/programs/moonup.bas">http://www.skypub.com/resources/software/basic/programs/moonup.bas</a></p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Seidelmann, P. Kenneth (ed)<br><i>Explanatory Supplement to the Astronomical Almanac</i><br>University Science Books<br>1992, completely revised<br>ISBN 0-935702-68-7</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Definitive reference on all aspects of the<span>&nbsp;</span><cite>ephemeris
and associated calculations. No hostages taken, no example calculations
and modern vectoral notation used throughout. Sections 9.311 (p484) and
9.33 (p486) present the iterative algorithm for Sunrise for moderate
latitudes.</cite></p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Duffett-Smith, Peter<br><cite>Practical Astronomy with your calculator</cite><br>Cambridge University Press<br>3rd edition 1988<br>ISBN 0-521-35699-7</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">Good
treatment of the basics of coordinate systems. Presents the formulas
for rise and set time of a star, and presents an interesting linear
interpolation scheme for Moonrise.</p>
<p style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">[<span>&nbsp;</span><a href="http://www.stargazing.net/kepler/index.html#top">Root</a><span>&nbsp;</span>]</p>
<hr style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;"><span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">Last Modified 2000 Jan 3rd</span><br style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<span style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; background-color: rgb(255, 255, 255); display: inline ! important; float: none;">Keith Burnett</span><br style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">
<address style="color: rgb(0, 0, 0); font-family: &quot;Times New Roman&quot;; font-size: medium; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px;">keith@xylem.demon.co.uk</address>
<br class="Apple-interchange-newline">

  

</body></html>